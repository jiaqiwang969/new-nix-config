â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              è™šæ‹Ÿæœºåˆ›å»ºæ£€æŸ¥ç»“æœ                                       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… æ£€æŸ¥ç»“æœï¼š

1. UTM åº”ç”¨çŠ¶æ€
   âœ“ UTM æ­£åœ¨è¿è¡Œ
   âœ“ QEMU Helper è¿›ç¨‹å·²å¯åŠ¨

2. è™šæ‹Ÿæœºæ–‡ä»¶
   âœ“ è™šæ‹Ÿæœºå·²åˆ›å»º: NixOS-Dev-1.utm
   âœ“ ä½ç½®: ~/Library/Containers/com.utmapp.UTM/Data/Documents/

3. ç½‘ç»œè¿æ¥
   âœ“ è™šæ‹Ÿæœº IP å¯ä»¥ ping é€š: 192.168.64.10
   âœ“ å“åº”æ—¶é—´: 0.2-0.5ms (æ­£å¸¸)
   âœ— SSH ç«¯å£ (22) å°šæœªå¼€æ”¾

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“‹ å½“å‰çŠ¶æ€åˆ†æ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

è™šæ‹Ÿæœºå·²æˆåŠŸåˆ›å»ºå¹¶å¯åŠ¨ï¼Œç½‘ç»œè¿æ¥æ­£å¸¸ã€‚

SSH ç«¯å£æœªå¼€æ”¾è¯´æ˜ï¼š
  â€¢ è™šæ‹Ÿæœºæ­£åœ¨è¿è¡Œ NixOS Live ç¯å¢ƒ
  â€¢ è¿˜æ²¡æœ‰å®‰è£… NixOS åˆ°ç£ç›˜
  â€¢ æˆ–è€…æ­£åœ¨å®‰è£…è¿‡ç¨‹ä¸­

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ¯ ä¸‹ä¸€æ­¥æ“ä½œ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

è¯·åœ¨è™šæ‹Ÿæœºç»ˆç«¯ä¸­æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

æ­¥éª¤ 1: è®¾ç½® root å¯†ç 
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  sudo su
  passwd
  # è¾“å…¥å¯†ç : root

æ­¥éª¤ 2: ç£ç›˜åˆ†åŒº
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  # æŸ¥çœ‹ç£ç›˜
  lsblk

  # åˆ†åŒºï¼ˆé€šå¸¸æ˜¯ /dev/vdaï¼‰
  parted /dev/vda -- mklabel gpt
  parted /dev/vda -- mkpart primary 512MB -8GB
  parted /dev/vda -- mkpart primary linux-swap -8GB 100%
  parted /dev/vda -- mkpart ESP fat32 1MB 512MB
  parted /dev/vda -- set 3 esp on

  # æ ¼å¼åŒ–
  mkfs.ext4 -L nixos /dev/vda1
  mkswap -L swap /dev/vda2
  mkfs.fat -F 32 -n boot /dev/vda3

  # æŒ‚è½½
  mount /dev/disk/by-label/nixos /mnt
  mkdir -p /mnt/boot
  mount /dev/disk/by-label/boot /mnt/boot
  swapon /dev/vda2

æ­¥éª¤ 3: ç”Ÿæˆé…ç½®
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  nixos-generate-config --root /mnt

æ­¥éª¤ 4: ç¼–è¾‘é…ç½®æ–‡ä»¶
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  nano /mnt/etc/nixos/configuration.nix

åœ¨ system.stateVersion ä¹‹å‰æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

  # Nix Flakes
  nix.package = pkgs.nixVersions.latest;
  nix.extraOptions = ''
    experimental-features = nix-command flakes
  '';

  # ç½‘ç»œé…ç½® - é™æ€ IP
  networking.interfaces.enp0s10 = {
    useDHCP = false;
    ipv4.addresses = [{
      address = "192.168.64.10";
      prefixLength = 24;
    }];
  };
  networking.defaultGateway = "192.168.64.1";
  networking.nameservers = [ "192.168.64.1" "8.8.8.8" ];
  networking.hostName = "nixos-dev-1";

  # SSH
  services.openssh.enable = true;
  services.openssh.settings.PasswordAuthentication = true;
  services.openssh.settings.PermitRootLogin = "yes";

  # ç”¨æˆ·
  users.users.root.initialPassword = "root";
  users.users.jqwang = {
    isNormalUser = true;
    extraGroups = [ "wheel" "networkmanager" "docker" ];
    initialPassword = "jqwang";
  };

  # Sudo æ— å¯†ç 
  security.sudo.wheelNeedsPassword = false;

  # SPICE æ”¯æŒï¼ˆUTMï¼‰
  services.spice-vdagentd.enable = true;

  # è½¯ä»¶æ¸²æŸ“ï¼ˆM1 Macï¼‰
  environment.variables.LIBGL_ALWAYS_SOFTWARE = "1";

  # å…è®¸ä¸å—æ”¯æŒçš„ç³»ç»Ÿ
  nixpkgs.config.allowUnfree = true;
  nixpkgs.config.allowUnsupportedSystem = true;

ä¿å­˜: Ctrl+X, Y, Enter

æ­¥éª¤ 5: å®‰è£…
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  nixos-install --no-root-passwd

  # ç­‰å¾…å®‰è£…å®Œæˆï¼ˆ10-30 åˆ†é’Ÿï¼‰

æ­¥éª¤ 6: é‡å¯å‰ç§»é™¤ ISO
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

âš ï¸  åœ¨ UTM ä¸­ï¼š
  1. ç‚¹å‡»è™šæ‹Ÿæœºè®¾ç½®ï¼ˆé½¿è½®å›¾æ ‡ï¼‰
  2. æ‰¾åˆ° CD/DVD é©±åŠ¨å™¨
  3. ç‚¹å‡» "Clear" ç§»é™¤ ISO

ç„¶ååœ¨ VM ä¸­æ‰§è¡Œï¼š

  reboot

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ’¡ æç¤º
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â€¢ å¯ä»¥éšæ—¶æŸ¥çœ‹å®Œæ•´æ­¥éª¤ï¼š
  ./install-cheatsheet.sh

â€¢ å®‰è£…å®Œæˆåï¼Œè¿è¡ŒéªŒè¯è„šæœ¬ï¼š
  ./verify-vm.sh

â€¢ å¦‚æœé‡åˆ°é—®é¢˜ï¼Œéšæ—¶å‘Šè¯‰æˆ‘ï¼

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
